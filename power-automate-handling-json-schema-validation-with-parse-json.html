<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Power Automate: Handling JSON schema validation with Parse JSON - johnokeeffe</title><meta name="description" content="Introduction Had a scenario recently when working on a project where I needed to check some required columns from a staging excel file before it was inserted into a master excel file. Now in this case it only was a small subset of the overall&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://johnokeeffe..ie/power-automate-handling-json-schema-validation-with-parse-json.html"><link rel="alternate" type="application/atom+xml" href="https://johnokeeffe..ie/feed.xml"><link rel="alternate" type="application/json" href="https://johnokeeffe..ie/feed.json"><meta property="og:title" content="Power Automate: Handling JSON schema validation with Parse JSON"><meta property="og:site_name" content="johnokeeffe"><meta property="og:description" content="Introduction Had a scenario recently when working on a project where I needed to check some required columns from a staging excel file before it was inserted into a master excel file. Now in this case it only was a small subset of the overall&hellip;"><meta property="og:url" content="https://johnokeeffe..ie/power-automate-handling-json-schema-validation-with-parse-json.html"><meta property="og:type" content="article"><link rel="stylesheet" href="https://johnokeeffe..ie/assets/css/style.css?v=4128e7e1a641a287245dedc222b18c79"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://johnokeeffe..ie/power-automate-handling-json-schema-validation-with-parse-json.html"},"headline":"Power Automate: Handling JSON schema validation with Parse JSON","datePublished":"2022-08-06T00:16","dateModified":"2022-08-06T00:16","description":"Introduction Had a scenario recently when working on a project where I needed to check some required columns from a staging excel file before it was inserted into a master excel file. Now in this case it only was a small subset of the overall&hellip;","author":{"@type":"Person","name":"johnokeeffe","url":"https://johnokeeffe..ie/authors/johnokeeffe/"},"publisher":{"@type":"Organization","name":"johnokeeffe"}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://johnokeeffe..ie/">johnokeeffe</a></header><main><article class="post"><div class="hero"><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2022-08-06T00:16">August 6, 2022</time></div><h1>Power Automate: Handling JSON schema validation with Parse JSON</h1><div class="post__meta post__meta--author"><a href="https://johnokeeffe..ie/authors/johnokeeffe/" class="feed__author">johnokeeffe</a></div></div></header></div><div class="wrapper post__entry"><h1 id="introduction">Introduction</h1><p>Had a scenario recently when working on a project where I needed to check some required columns from a staging excel file before it was inserted into a master excel file. Now in this case it only was a small subset of the overall columns in the excel were actually needed for the process. But I didn’t want the whole process to fall over if only one row was missing so I used the some scopes, parse JSON and JSON schema magic to build the below solution to get around it.</p><h1 id="walk-through">Walk-through</h1><h2 id="scenario">Scenario</h2><p>In the below fake scenario we receive car owner data in an excel table. We need to take this data and insert the rows in a master excel for analysis. We’re really only looking for the owner personal data and the car vehicle identification number (vin) as we can lookup the rest of the data from the vin. But if this vin is missing then this data isn’t as useful to us as we can’t guarantee they will also provide there car details.</p><h2 id="sample-data">Sample Data</h2><table><thead><tr><th>id</th><th>first_name</th><th>last_name</th><th>email</th><th>car_make</th><th>car_model</th><th>car_model_year</th><th>car_vin</th></tr></thead><tbody><tr><td>1</td><td>Chrisse</td><td>Marieton</td><td><a href="mailto:&#99;&#x6d;&#97;&#114;&#105;&#x65;&#x74;&#x6f;&#x6e;&#x30;&#64;&#x75;&#109;&#110;&#x2e;&#101;&#100;&#117;">&#99;&#x6d;&#97;&#114;&#105;&#x65;&#x74;&#x6f;&#x6e;&#x30;&#64;&#x75;&#109;&#110;&#x2e;&#101;&#100;&#117;</a></td><td></td><td></td><td></td><td>2G61L5S37E9694881</td></tr><tr><td>2</td><td>Dion</td><td>Frenchum</td><td><a href="mailto:&#100;&#102;&#x72;&#101;&#x6e;&#99;&#x68;&#x75;&#x6d;&#49;&#64;&#x6e;&#105;&#x66;&#116;&#x79;&#46;&#x63;&#111;&#109;">&#100;&#102;&#x72;&#101;&#x6e;&#99;&#x68;&#x75;&#x6d;&#49;&#64;&#x6e;&#105;&#x66;&#116;&#x79;&#46;&#x63;&#111;&#109;</a></td><td></td><td></td><td></td><td>NM0AE8F74E1334359</td></tr><tr><td>3</td><td>Brockie</td><td>Bushaway</td><td><a href="mailto:&#98;&#x62;&#117;&#115;&#x68;&#97;&#119;&#x61;&#x79;&#50;&#64;&#x67;&#x6f;&#111;&#103;&#x6c;&#101;&#46;&#99;&#111;&#x2e;&#x75;&#107;">&#98;&#x62;&#117;&#115;&#x68;&#97;&#119;&#x61;&#x79;&#50;&#64;&#x67;&#x6f;&#111;&#103;&#x6c;&#101;&#46;&#99;&#111;&#x2e;&#x75;&#107;</a></td><td></td><td></td><td></td><td>WBAUN1C55DV305824</td></tr><tr><td>4</td><td>Janie</td><td>Iacomelli</td><td><a href="mailto:&#x6a;&#x69;&#x61;&#99;&#111;&#x6d;&#x65;&#x6c;&#108;&#x69;&#51;&#64;&#117;&#105;&#117;&#x63;&#x2e;&#x65;&#100;&#117;">&#x6a;&#x69;&#x61;&#99;&#111;&#x6d;&#x65;&#x6c;&#108;&#x69;&#51;&#64;&#117;&#105;&#117;&#x63;&#x2e;&#x65;&#100;&#117;</a></td><td></td><td></td><td></td><td>WA1AGAFE7CD051379</td></tr><tr><td>5</td><td>Cassie</td><td>Housby</td><td><a href="mailto:&#99;&#x68;&#x6f;&#117;&#x73;&#98;&#121;&#x34;&#64;&#105;&#99;&#113;&#46;&#99;&#x6f;&#109;">&#99;&#x68;&#x6f;&#117;&#x73;&#98;&#121;&#x34;&#64;&#105;&#99;&#113;&#46;&#99;&#x6f;&#109;</a></td><td>Mitsubishi</td><td>Lancer Evolution</td><td>2004</td><td></td></tr></tbody></table><p>Sample Data Schema <a href="https://www.mockaroo.com/1591bbc0">Mockaroo Link</a></p><h2 id="flow-structure-setup">Flow Structure Setup</h2><p>To get started I just created a basic flow structure:</p><ul><li>Variable outputData is an array and we will use this later on as we append data to it</li><li>Variable outputAction is going to be use to output the action that was taken ie. <em>“inserted into master table” or “error missing column data”</em></li><li>List rows present in the excel table (see above for schema and sample data)</li></ul><p>I like to use scopes to help with error handling and logical design of the flows. I won’t be discussing scope error handling in this blog but here is a great resource to read over to get you started <a href="https://www.portiva.nl/portiblog/advanced-error-handling-in-power-automate">Advanced error handling in Power Automate</a></p><p></p><figure class="post__image"><img loading="lazy" src="https://raw.githubusercontent.com/john-o-keeffe/BlogResources/main/power-automate-handling-json-schema-validation-with-parse-json/pa-setup-01.png" data-is-external-image="true" alt="Power Automate setup flow"></figure><p></p><h2 id="flow-json-schema-validation-setup">Flow JSON Schema Validation Setup</h2><p>In this step I just create a loop to run through each row returned from the <em>list rows present in a table</em> action from above. Now we need to generate the schema for the parse json easiest way to do this is to just run the flow once. Now what we need to do is take this schema and add some constraints too it. Now in the below example all the data types are strings but this can work with other data types. See the <a href="https://json-schema.org/understanding-json-schema/index.html">JSON Schema Docs</a></p><p>Below you can see I have added the <a href="https://json-schema.org/understanding-json-schema/reference/string.html#id5">minLength</a> constraint to some of the objects. This means JSON is looking for each of the objects to have at least one string character present otherwise it will create a validation error. This will be the error we will read from later on. Now just create two more scopes one for the “Happy path” (Success) and the “Unhappy Path” (Error). Setup the “Unhappy path” to only run on <strong>has failed</strong>.</p><pre><code class="language-json"> {
  &quot;car_vin&quot;: {
           &quot;type&quot;: &quot;string&quot;,
           &quot;minLength&quot;: 1
       }
 }
</code></pre><pre><code class="language-json">{
    &quot;type&quot;: &quot;object&quot;,
    &quot;properties&quot;: {
        &quot;@@odata.etag&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;ItemInternalId&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;id&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;minLength&quot;: 1
        },
        &quot;first_name&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;minLength&quot;: 1
        },
        &quot;last_name&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;minLength&quot;: 1
        },
        &quot;email&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;minLength&quot;: 1
        },
        &quot;car_make&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;car_model&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;car_model_year&quot;: {
            &quot;type&quot;: &quot;string&quot;
        },
        &quot;car_vin&quot;: {
            &quot;type&quot;: &quot;string&quot;,
            &quot;minLength&quot;: 1
        }
    }
}
</code></pre><p></p><figure class="post__image"><img loading="lazy" src="https://raw.githubusercontent.com/john-o-keeffe/BlogResources/main/power-automate-handling-json-schema-validation-with-parse-json/pa-main-scope-loop-parse.png" data-is-external-image="true" alt="Power Automate main scope setup with parse json"></figure><p></p><h2 id="unhappy-path-important-step">Unhappy Path (Important Step)</h2><p>This is the important step and a key to the whole flow. Setup any action in this case im using a compose to make it clearer but setup an expression like the one below that will take the error output from the Parse JSON.</p><pre><code class="language-plain">  outputs(&#39;Parse_JSON&#39;)?[&#39;errors&#39;]
</code></pre><p>The error output will only appear when the validation has failed otherwise it just displays the body like normal. It outputs an array as seen in the below example. The key objects to look at the <strong>Path</strong>, <strong>errorType</strong> and <strong>message</strong>. If you have more complex schemas some more of this information will become useful to you when handling errors for me in this case I only need two.</p><pre><code class="language-json"> [
    {
        &quot;message&quot;: &quot;String &#39;&#39; is less than minimum length of 1.&quot;,
        &quot;lineNumber&quot;: 0,
        &quot;linePosition&quot;: 0,
        &quot;path&quot;: &quot;car_vin&quot;,
        &quot;value&quot;: &quot;&quot;,
        &quot;schemaId&quot;: &quot;#/properties/car_vin&quot;,
        &quot;errorType&quot;: &quot;minLength&quot;,
        &quot;childErrors&quot;: []
    }
]
</code></pre><p>Now that I have an array with the errors im going to create another loop, to go though these errors set my <em>outputAction</em> variable with a custom message. This will then be append to the <em>outputData</em> array which will be used later on for a emailed report.</p><pre><code class="language-plain">  items(&#39;Apply_to_each_error&#39;)?[&#39;path&#39;]
</code></pre><p></p><figure class="post__image"><img loading="lazy" src="https://raw.githubusercontent.com/john-o-keeffe/BlogResources/main/power-automate-handling-json-schema-validation-with-parse-json/pa-unhappy-path.png" data-is-external-image="true" alt="Power Automate Unhappy Path"></figure><p></p><h2 id="happy-path">Happy Path</h2><p>The happy path in this case is pretty simple and is where you would put the insert into excel table action. In this case I am just setting the <em>outputAction</em> variable again with a custom message to say the insert was a success. Then just appending this to the array which will be used next.</p><p></p><figure class="post__image"><img loading="lazy" src="https://raw.githubusercontent.com/john-o-keeffe/BlogResources/main/power-automate-handling-json-schema-validation-with-parse-json/pa-happy-path.png" data-is-external-image="true" alt="Power Automate Happy Path"></figure><p></p><h2 id="output">Output</h2><p>Last but not least the output of all that data we just logged into the <em>outputData</em> variable. Because the variable I had created at the start is an array this will allow us to use the <em>create html table</em> action easily, to create a html table we can use in Email, Teams etc…</p><p></p><figure class="post__image"><img loading="lazy" src="https://raw.githubusercontent.com/john-o-keeffe/BlogResources/main/power-automate-handling-json-schema-validation-with-parse-json/pa-output.png" data-is-external-image="true" alt="Power Automate Output"></figure><p></p><p></p><figure class="post__image"><img loading="lazy" src="https://raw.githubusercontent.com/john-o-keeffe/BlogResources/main/power-automate-handling-json-schema-validation-with-parse-json/pa-email-report.png" data-is-external-image="true" alt="Power Automate Output"></figure><p></p><h2 id="conclusion">Conclusion</h2><p>This isn’t the only approach to error handling in power automate. But I found in this case it was useful way of solving my issue and also learnt something new in the process.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on August 6, 2022</p><div class="post__share"></div><div class="post__bio bio"><div class="bio__info"><h3 class="bio__name"><a href="https://johnokeeffe..ie/authors/johnokeeffe/" rel="author">johnokeeffe</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://johnokeeffe..ie/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://johnokeeffe..ie/logic-app-basic-xml-to-json-expression-conversion.html" class="post__nav-link" rel="prev"><span>Previous</span> Logic App: Basic XML to JSON Expression Conversion</a></div></div></nav><div class="post__related related"><div class="wrapper"><h2 class="h5 related__title">You should also read:</h2><article class="related__item"><div class="feed__meta"><time datetime="2022-08-06T00:15" class="feed__date">August 6, 2022</time></div><h3 class="h1"><a href="https://johnokeeffe..ie/logic-app-basic-xml-to-json-expression-conversion.html">Logic App: Basic XML to JSON Expression Conversion</a></h3></article></div></div></main><footer class="footer"><div class="footer__copyright"><p>Powered by Publii</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://johnokeeffe..ie/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://johnokeeffe..ie/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>